name: "Sphinx: Documentation Generator"

on:
    push:
        branches: [main]
        paths:
            - "docs/**"
            - "pyproject.toml"
            - ".github/workflows/sphinx-docs.yml"

jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Build Sphinx HTML
              run: |
                  pip install sphinx
                  make -C docs html
                  mkdir -p docs/html
                  cp -r docs/_build/html/* docs/html/
                  touch docs/html/.nojekyll

            - name: Commit rendered docs
              run: |
                  git config user.name "github-actions[bot]"
                  git config user.email "github-actions[bot]@users.noreply.github.com"
                  git add docs/html
                  git commit -m "Update built docs" || echo "No changes to commit"
                  git push
